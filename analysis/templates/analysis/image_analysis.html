{% extends 'users/base.html' %}
{% load static %}

{% block title %}Image Analysis - Korean Learning{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'analysis/css/image_analysis.css' %}">
<link rel="stylesheet" href="{% static 'analysis/css/interactive.css' %}">
{% endblock %}

{% block content %}
<div class="image-analysis-container">
    <div class="card">
        <div class="card-header">
            <h2 style="margin: 0;">Image Analysis with OCR</h2>
            <p style="margin: 8px 0 0 0; opacity: 0.9;">Upload an image and make Korean words interactive for learning</p>
        </div>
        
        <div class="file-input-container" id="fileContainer">
            <input type="file" id="imageInput" class="file-input" accept="image/*">
            <label for="imageInput" class="file-label">
                üìÅ Click to upload an image or drag and drop
            </label>
        </div>
        
        <div class="controls">
            <label>Confidence Threshold: <span class="confidence-value" id="confidenceValue">0.30</span></label>
            <input type="range" id="confidenceSlider" class="confidence-slider" min="0.1" max="0.9" step="0.05" value="0.30">
            <button class="btn" id="processBtn" disabled>
                <span>Process Image</span>
                <div class="loading-spinner" id="loadingSpinner" style="display: none;"></div>
            </button>
            <button class="btn btn-success" id="finishBtn" disabled>Finish Analysis</button>
        </div>
        
        <div id="imageContainer" class="image-container" style="display: none;">
            <img id="ocrImage" class="ocr-image" alt="OCR Image">
        </div>
        
        <div id="wordInfo" class="word-info" style="display: none;">
            <h4>Extracted Words:</h4>
            <div id="wordList"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'analysis/js/image_analysis.js' %}"></script>
<script type="module" src="{% static 'analysis/js/interactive/index.js' %}"></script>
<script>
    // Initialize with Django context data
    window.USER_VOCAB_WORDS = new Set({{ vocab_words|safe }});
    window.CSRF_TOKEN = '{{ csrf_token }}';
    window.ANALYSIS_URLS = {
        trackHover: '{% url "analysis:track_hover" %}',
        imageAnalysis: '{% url "analysis:image_analysis" %}'
    };
</script>
{% endblock %}
