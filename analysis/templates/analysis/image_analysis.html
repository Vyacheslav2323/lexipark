{% extends 'users/base.html' %}
{% load static %}

{% block title %}Image Analysis - Korean Learning{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'analysis/css/image_analysis.css' %}">
<link rel="stylesheet" href="{% static 'analysis/css/interactive.css' %}">
{% endblock %}

{% block content %}
<div class="image-analysis-container">
    <div class="card">
        <div class="card-header">
            <h2 style="margin: 0;">Image Analysis with OCR</h2>
            <p style="margin: 8px 0 0 0; opacity: 0.9;">Upload an image and make Korean words interactive for learning</p>
        </div>
        
        <div class="file-input-container" id="fileContainer">
            <input type="file" id="imageInput" class="file-input" accept="image/*">
            <label for="imageInput" class="file-label">
                üìÅ Click to upload an image or drag and drop
            </label>
        </div>
        
        <div class="controls">
            <button class="btn" id="processBtn" disabled style="width: 100%;">
                <span>Process Image</span>
                <div class="loading-spinner" id="loadingSpinner" style="display: none;"></div>
            </button>
        </div>
        
        <div id="imageViewport" class="image-viewport">
            <div id="imageContainer" class="image-container" style="display: none;">
                <img id="ocrImage" class="ocr-image" alt="OCR Image">
            </div>
        </div>

        <div class="controls" style="margin-top: 16px;">
            <button id="finish-analysis-btn" class="btn" style="display: none; width: 100%;">
                <span>Finish analysis</span>
                <div id="finish-spinner" class="loading-spinner" style="display: none; margin-left: 8px;"></div>
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'analysis/js/image_analysis.js' %}?v=3"></script>
<script type="module" src="{% static 'analysis/js/interactive/index.js' %}?v=3"></script>
<script>
    // Initialize with Django context data
    window.USER_VOCAB_WORDS = new Set(JSON.parse('{{ vocab_words_json|escapejs }}'));
    window.CSRF_TOKEN = '{{ csrf_token }}';
    window.IS_AUTHENTICATED = ('{{ user.is_authenticated|yesno:"true,false" }}' === 'true');
    window.ANALYSIS_URLS = {
        trackHover: '{% url "analysis:track_hover" %}',
        imageAnalysis: '{% url "analysis:image_analysis" %}'
    };
</script>
{% endblock %}
